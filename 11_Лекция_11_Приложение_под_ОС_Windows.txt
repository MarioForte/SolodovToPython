Лекция 11
Приложение под ОС Windows

Цель лекции. Изучить приложение ОС Windows, его основные характеристики и принцип работы с ним. Разобрать назначение окон присутствующих в Windows Form.

11.1. Основные характеристики приложения Windows Form
При запуске Microsoft Visual C#  предоставляет возможность командой Файл \ Создать проект  создать приложение Windows Form – под операционную систему Windows с графическим интерфейсом (рис.11.1) 

Рис. 11.1 – Начальная страница Visual C#

ИСР позволяет создавать решения, включающие набор проектов. Приложение Windows Form позволяет использовать все функциональные возможности операционной системы, отличается большими размерами исполняемого файла. На рисунке 11.2 Представлено окно создание проекта, в нем выбирается команда Приложение Windows Form и нажимается  кнопка ОК.

Рис.11.2 – Окно создание проекта
На рис.11.3 Представлен основной экран среды Windows Form и его содержание.

Рис.11.3 – Основной экран среды
Окно содержит:
Строку заголовка, которая отображает имя открытого проекта;
Строку меню с набором команд для разработки, тестирования приложений;
Панель инструментов с кнопками, соответствующие основным командам меню;
Конструктор формы – средство разработки приложения,
Редактор кода – для написания адекватных методов объектам приложения,
Панель элементов отображает компоненты (или объекты), с помощью которых создается графическое приложение. 
Свойства (события) элементов создаваемого приложения,
Список ошибок – отображающихся при вводе кода и его компиляции,
Обозреватель решений, в котором отображается описание решения.
Microsoft Visual является однодокументной средой, то есть позволяет работать только с одним проектом. 
Элементы подразделяются на:
Визуальные (кнопки, меню, поля редактирования, переключатели, списки…), 
Логические   (окна диалога, отчеты, часы…), отображающиеся в процессе запуска приложения. 

11.2 Окна «Конструктора формы», «Редактора кода», «Свойства элементов»
Окно «Конструктора форм» первоначально имеет заголовок Form1 – является заготовкой разрабатываемого приложения.
Форма – основа разработки, в нее помещают необходимые компоненты, создают интерфейс программы. Объекты выбираются на Панели элементов.
Для размещения объекта на форме необходимо:
1.Щелкнуть мышью на пиктограмме нужного объекта
2. Щелкнуть в том месте Формы, где должен быть он расположен. 
Это продемонстрировано на рис. 11.3

11.3 – Окно конструктора формы
Рассмотрим следующее окно «Редактор кода», оно имеет заголовок Windows Forms.Applicayion.Form1 (рис.11.4)

Рис.11.4 – Окно «редактор кода»
Редактор содержит шаблон программы - исходный текст модуля разработки. Редактор кода и форма тесно связаны между собой.
В Окне Редактора кода отображаются стандартные  модули, пространство имен, объявленный по умолчанию класс Form1 и инициализация объектов, установленных на форме. 

Окно «Свойства элементов» отражает поведение данного объекта для текущей формы Form1 (рис.11.5)   
Окно предназначено для редактирования значений свойств объектов и создания обработчиков событий. 
Состоит из страниц / вкладок – свойства и события

Рис.11.5 – Окно «Свойства элементов»
Страница Свойство (список) отображает информацию о текущем компоненте. 
Страница События (список событий) определяет процедуру, которую компонент должен выполнить при возникновении указанного события.

Работа с проектом
Характеристика проекта
Приложение (например, Demo) имеет несколько файлов, объединенных в проект:
Папка, например P, с файлами                      –   Demo
Файл решение                                                  –   P.ch
Файл – опции                                                    –   P.suo

Файлы проекта располагаются в одном каталоге (папке) P.
Сохранение проекта – приложения под Windows
Выполняется командой Файл \ Сохранить все как показано на рис.11.6 

Рис.11.6 – Сохранение проекта
Запуск и компиляция приложения.
Сборка проекта выполняется командой Отладка/Начать отладку
При этом образуются исполняемые и объектные файлы, перекомпилируются все модули, входящие в проект. 
Таблица 11.1
Решение в папке P
Исполняемые (bin) и объектные (obj) файлы образуются при компиляции (построении). Возможны два режима решения:
Команда Построение => Построить решение. Построение в режиме отладки: в компонуемые файлы включаются символы отладки и режим оптимизации исключается. Это может увеличить размеры файлов. Файлы размещаются в папках Debug. 
Команда Построение => Перестроить решение (в версии Express отсутствует). Построение отлаженного проекта, когда в компонуемые файлы  символы отладки не включаются и компилятор использует режим оптимизации кода (например, исключает не использованные переменные). Это может уменьшить размеры файлов. Файлы размещаются в папках Release.

11.4 Шаблон кода:
Стандартные модули (по умолчанию)
using System;                        //системный        
using System.Collections.Generic;    //с коллекциями 
using System.ComponentModel;         //с компонентами   
using System.Data;                   //дата/время    
using System.Drawing;                //с инструментами рисования   
using System.Linq;                   //с языковыми средствами 
using System.Text;                   //для работы с текстом 
using System.Windows.Forms;          //с формой под Windows

namespace WindowsFormsApplication1 //пространство имен приложения1
{
    public partial class Form1 : Form //объявление класса Form1
    {
        public Form1()               // объявление объекта Form1
        {
            InitializeComponent();   // объявление компонентов
        }                            // на Form1
    }
}
Интерфейс Windows.Forms состоит из сотен типов, которые объединены в пространстве имен namespace. 

11.4 Разработка приложения
Разработка приложения состоит из двух этапов:
Создание интерфейса приложения,
Определение функциональности приложения с написанием адекватных процедур.
Интерфейс приложения определяет способ взаимодействия пользователя и приложения, т.е. внешний вид формы при выполнении приложения и то, каким способом пользователь управляет приложением.
Для создания интерфейса необходимо:
выбрать нужные объекты на Панели элементов;
определить внешний вид и функциональные возможности компонентов;
используя Конструктора Формы, расположить компоненты на форме.
Функциональность приложения определяется процедурами, которые выполняются при возникновении определенных событий, происходящих при действиях пользователя с элементами формы.
Для обеспечения функциональности приложения необходимо:
задать в Окне Свойства значения свойств и процедур обработки событий;
написать программный код для заданных процедур обработки событий.
Простейшее приложение
Представляет собой заготовку, обеспечивающую все необходимое для приложения. Это форма, для которой уже созданы файлы с описанием формы и шаблоном кода.
Форма отображается при первом запуске ИСР и содержит основные элементы окна Windows: 
заголовок  Form1, 
кнопки минимизации, максимизации и закрытия окна, изменения размеров окна и кнопку вызова системного меню. 

При создании приложений на форму помещаются компоненты, для которых устанавливаются свойства и создаются обработчики событий. 
К простейшему приложению разработчик может добавлять  другие формы (Form2…). Например, графический интерфейс с выводом двух функций Sin(x) и Cos(x) (рис.11.7)


Рис.11.7 – Форма с компонентами
Создание интерфейса приложения
Интерфейс приложения составляют компоненты.
Свойства компонента это атрибуты, определяющие способ отображения и функционирования компонент (рис.11.8).

Рис.11.8 – Изменение свойства компонента
Для изменения значения свойств с помощью Окна элементов необходимо:
щелкнуть мышью по его имени в левой колонке страницы Свойство;
установить значение в соответствующей ячейке правой колонки:
нажать клавишу <Enter>.


Типы свойств:
простые – это те, значения которых являются числами или строками. Например, Text, Name, Left, Top, Width, Height;
перечисляемые – это те, которые могут принимать значения из предложенного набора (списка). Например, тип Bool  принимает значение True или False или ForeColor (рис.11.9)

Рис.11.9 – Перечисляемые свойства
вложенные – это те, которые поддерживают вложенные значения (или объекты). Имеются два вида: множества (…) Например, Items и комбинированные значения ( + ) (рис.11.10)..

Рис.11.10 – Вложенные свойства
Изменять свойства объектам можно двумя способами:
С помощью Окна Свойства (в режиме проектирования приложения – задаются стартовые значения свойств компонентов);
Программно – путем создания адекватных процедур с соответствующими строками кода (переопределение свойств в процессе выполнения).
При выполнении приложения свойства компонентов можно изменять с помощью операторов присваивания.
Например, 
изменение программно надписи кнопки Button1:
button1.Text = " Решить";           //надпись кнопки
изменение размеров многострочного редактора richTextBox1:
richTextBox1.Height = 100;         // высота  
richTextBox1.Width = 150;          // ширина
изменение текста и цвета шрифта в метке label1:
        label1.Text = "Студент";             //текст со словом Студент 
         label1.ForeColor=Color.Red;      //цвет шрифта красный

Определение функциональности приложения
Событие – это то, что происходит во время работы программы. В C# каждому событию присваивается имя.
Реакция окна на разного рода действия пользователя определяет функциональность приложения. 
Обработчик событий – определяет действие, которое можно поручить выделенному компоненту. Каждый компонент имеет набор стандартных обработчиков событий, отображающихся в Окне Свойство на вкладке События (рис.11.11).

Рис.11.11 – Окно «Свойства»
Чтобы при нажатии на кнопке "Закрыть" кнопка реагировала на событие завершения работы, необходимо создать процедуру обработки события, которая будет вызываться при возникновении данного события (например, OnClick).
1) выделить на форме компонент;
2) перейти на страницу событий Окна Свойства;
3) сделать двойной щелчок в области значения события, например OnClick, ( ИСР автоматически создаст в модуле формы заготовку процедуры-обработчика).
4) в редакторе кода, вместе, где установится курсор написать код, который будет выполняться при нажатии кнопки Button1, т.е набрать строку  Close() (рис.11.12); 

Рис.11.12 – Редактор кода
При наборе кода включается интерактивный подсказчик, который лучше использовать для избегания ошибок в наборе слов (рис.11.13).

Рис.11.13 – Интерактивный подсказчик
Все остальное  среда  создает автоматически.
Обработчики щелчка по объектам, например Button1Click, можно создать и быстрее, путем двойного щелчка по объекту, находящемуся на Форме.
private void button1_Click(object sender, EventArgs e)
Слова
Private – метод закрыт и предназначен для внутреннего использования в классе
 void – начало метода – процедура,
Button1_Click – собственно имя процедуры,
() – список параметров.
Для удаления процедуры-обработчика достаточно удалить заготовку и код, который программист вносил в нее самостоятельно.  После этого при сохранении или компиляции модуля обработчик будет удален автоматически из всех файлов проекта.
Пример. Создать проект для изучения некоторых простых свойств объектов.
Последовательность действий:
Создаем Приложение Windows Forms. 
Устанавливаем на форму нужные компоненты
Устанавливаем стартовые значения объектам, например Кнопке надпись Задача.
Создаем обработчик события Form1_Activated – (активизация формы) при исполнении которого свойства объектов меняются программно на иные.
Отлаживает проект путем устранения синтаксических ошибок.
Проверяет полученные результаты на соответствие поставленной задачи.
3. Изменяет значения Text  кнопки button1 на надпись Пример (рис.11.14)

Рис.11.14 – Изменение значения  Text
4. Создаем обработчик события Form1_Activated для выделенной Формы Form1 (рис.11.15)

Рис.11.15 – Обработчик событий Form1_Activated
Записываем код процедуры Form1_Activated.
4. Создаем обработчик события button1_Click для выделенной кнопки button1 (рис.11.16)

Рис. 11.16 – Обработчик событий button1_Click
Записываем код процедуры button1_Click. Аналогично для button2.
Листинг программы:
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        public Form1()
        {
           InitializeComponent();
        }
        private void Form1_Activated(object sender, EventArgs e)
        {
           button1.Text = "Задача";            // надпись на кнопке
           richTextBox1.Height = 100;          // высота объекта 
           richTextBox1.Width = 150;           // ширина объекта
           label1.ForeColor=Color.Red;         // цвет шрифта красный
           label1.Text = "Студент";            // вывод текста 
           label1.ForeColor=Color.Red;         // цвет шрифта красный
           richTextBox1.Text = "Мы изучаем C#";// вывод текста
        }
       private void button1_Click(object sender, EventArgs e)
        {
           label1.Text = "Студент ПГУТИ";       // вывод текста             
           richTextBox1.ForeColor = Color.Blue; // цвет шрифта синий
           richTextBox1.Text = "Мы активно работаем"; //вывод текста
        }
        private void button2_Click(object sender, EventArgs e)
        {
           Close();                            // закрытие формы
        }
    }
}
Результат исполнения: Активизация формы  и   Щелчок по кнопке «Задача» (рис.11.17)

Рис.11.17 – Результат выполнения задачи
 Отладка
Тестирование – процесс проверки работоспособности программы, в процессе которой выявляются разного рода ошибки.
Процесс поиска и устранения ошибок называется отладкой.
Классификация ошибок
Программ без ошибок не бывает. Ошибки допускает любой программист: и начинающий, и имеющий тридцатилетний опыт. Компилятор генерирует исполняемую программу лишь в том случае, если исходный текст не содержит синтаксических ошибок.
В процессе выполнения программы возникают ошибки следующих видов:
Синтаксические (ошибки времени компиляции),
Логические (алгоритмические – ошибочные рассуждения),
Динамические (ошибки времени выполнения) – исключительные ситуации.
Синтаксические ошибки возникают при нарушении синтаксиса языка. Они выявляются и устраняются при компиляции программы. Сообщения о найденных ошибках отображаются в Окне Списка ошибок. Например, 

При обнаружении в программе неточностей, которые не являются ошибками, компилятор выводит подсказки и предупреждения. 
Логические ошибки являются следствием реализации неправильного алгоритма и проявляются при выполнении программы. Сообщения компилятором не выдаются, но программа работает не корректно и выдаёт не правильные результаты.
Например, два выражения y=ln(x)/x+5 и y=ln(x)/(x+5) дадут разные результаты.
Поэтому при получении результата его надо анализировать. Составляются тесты и отлаживаются программы на тех значениях входных данных, результат при которых легко проверить путем подсчета его «вручную».
Например, при х=1 ln(x)= 0 и 
результат первого выражения y=ln(x)/x+5 даст y=1/1+ 6 = 6, 
а второго  выражения y=ln(x)/(x+5) даст y=1/(1+5)=1/ 6 = 0.1666
Динамические ошибки возникают при выполнении программы и являются следствием неправильной работы операторов, подпрограмм, методов программы и операционной системы. 
Исключительная ситуация (exception) представляет собой нарушение условий выполнения программы, вызывающее прерывание или полное прекращение ее работы. 
Например, если пользователь в редактор textBox2 ввел букву, вместо цифры, то ИСР сгенерирует окно ошибки и проект будет закрыт. 

Чтобы этого не произошло, вводим свой обработчик исключительных ситуаций и в окне появляется надпись об ошибочном вводе данных. 
Пример показан на рис.11.18

Рис.11.18 – Пример
После внесения изменения в textBox2 и нажатия кнопки «Вычислить» можно продолжить выполнение программы или прервать ее выполнение. Обработка исключительной ситуации состоит в нейтрализации динамической ошибки, вызвавшей ее.

Краткие итоги. В лекции были рассмотрены вопросы, относящиеся к приложению ОС Windows. Даны его основные характеристики. Описан процесс создания проекта в Windows Form. Расмотрены характеристики проекта.

Контрольные вопросы
Перечислите основные характеристики Приложение под ОС Windows.
Перечислите элементы Windows Form.
Что необходимо для размещения объекта на форме.
Что отражает окно свойства элементов?
Дайте краткую характеристику проекта.
Перечислите этапы разработки приложения.
Что необходимо для создания интерфейса?
Как обеспечить функциональность приложения?
Перечислите типы свойств.
Как можно изменить свойства объекта?
Приведите примеры изменения свойств объекта.
Дайте определение понятию «Событие».
Какие виды ошибок возникают в процессе выполнения программы?